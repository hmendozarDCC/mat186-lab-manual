---
title: "Lab 17: Linear Regression"
author: "MAT186: Introduction to Data Science"
date-modified: last-modified
params:
  dataset: "data/2026_Fall/lbw.csv"
---


## Learning Objectives
* Understand the Linear Regression equation: $y = \beta_0 + \beta_1x + \epsilon$.
* Calculate and interpret the **Correlation Coefficient ($r$)**.
* Fit a Linear Model in R using the `lm()` function.
* Evaluate model fit using **R-squared ($R^2$)**.


## Data Acquisition: Birth Weight Dataset (lbw.csv)

To complete the regression exercises, you need the `lbw.csv` dataset. Choose **one** of the methods below to load the data into R.

---

## Option 1: Direct Link (Recommended)
This method pulls the data directly from the lab manual website.
## Data Loading and Preview

We are using the `lbw` dataset, which contains information on low birth weight.

> **Accessible Logic:** We use the `read_csv()` function to pull data from a web URL. After loading, it is important to check the "head" (the first 6 rows) to ensure the columns and values imported correctly.

```{r}
#| label: tbl-data-preview
#| tbl-cap: "Preview of the first six rows of the low birth weight (LBW) dataset."
#| message: false

library(tidyverse)

# 1. Load the data
url <- url <- "https://vincentarelbundock.github.io/Rdatasets/csv/COUNT/lbw.csv"
lbw_data <- read_csv(url)

# 2. Display an accessible preview
# We use head() to get the first 6 rows and kable() to make it a table
knitr::kable(head(lbw_data))
```

## Option 2: Local File
Use this if the file is saved in your project folder.
## Loading Data Locally

To ensure this lab is reproducible, we are loading the birth weight data from our project's `data` folder.

> **Accessible Logic:** The path `"data/lbw.csv"` tells R to look inside a folder named **data** that is located in the same place as your script. This is called a **relative path**.

```{r}
#| label: tbl-local-load
#| tbl-cap: "Preview of the locally loaded LBW dataset."

# 1. Load the data using a relative path
# Ensure the 'data' folder exists in your RStudio project
lbw_data <- read.csv("../data/2026_Fall/lbw.csv")

# 2. Accessible Preview
knitr::kable(head(lbw_data))
```
---

## Part 1: Correlation ($r$)
Before building a model, we need to know if a linear relationship even exists. The correlation coefficient ($r$) ranges from **-1** to **1**.

* **1**: Perfect positive relationship.
* **0**: No relationship at all.
* **-1**: Perfect negative relationship.

## Correlation Analysis: Mother's Weight vs. Birth Weight

We are calculating Pearson's correlation coefficient to see if there is a linear relationship between the mother's weight at the last menstrual period (`lwt`) and the baby's birth weight (`bwt`).

> **Accessible Logic:** Correlation ($r$) ranges from -1 to +1. A value of 0 means no linear relationship, while values closer to +1 or -1 indicate stronger relationships.

```{r}
#| label: tbl-correlation-lbw
#| tbl-cap: "Pearson Correlation Coefficient between Mother's Weight and Birth Weight."

library(tidyverse)

# 1. Calculate the correlation
cor_result <- lbw_data |>
  drop_na(lwt, bwt) |>
  summarize(correlation = cor(lwt, bwt))

# 2. Display as an accessible table
knitr::kable(
  cor_result,
  col.names = c("Correlation Coefficient (r)"),
  digits = 3
)
```
---

## Part 2: Visualizing the Best Fit Line
We use `geom_smooth(method = "lm")` to draw the line that minimizes the distance between all data points (the "Ordinary Least Squares" method).

```{r}
#| label: fig-regression
#| fig-cap: "Regression of Birth Weight on Mother's Weight"
#| fig-alt: "Scatter plot showing a positive trend between mother's weight and infant birth weight with a blue regression line."

ggplot(lbw_data, aes(x = lwt, y = bwt)) +
  geom_point(alpha = 0.5, color = "#002147") + # DCC Navy
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  theme_minimal() +
  labs(title = "Predicting Birth Weight based on Mother's Weight",
       x = "Mother's Weight (lbs)",
       y = "Birth Weight (grams)")
```

---

## Part 3: Building the Model in R
In R, the "Linear Model" function is `lm()`. The syntax is `lm(dependent_variable ~ independent_variable)`.

## Simple Linear Regression: Predicting Birth Weight

We are fitting a linear model to see how well Mother's Weight (`lwt`) predicts Birth Weight (`bwt`). 

> **Accessible Logic:** We are looking for the equation of a line: $$bwt = \beta_0 + \beta_1(lwt)$$. 
> * The **Intercept** ($\beta_0$) is the predicted birth weight if the mother's weight was zero.
> * The **Slope** ($\beta_1$) tells us how many grams the birth weight increases for every 1-pound increase in mother's weight.



```{r}
#| label: tbl-regression-results
#| tbl-cap: "Regression coefficients for predicting Birth Weight from Mother's Weight."

library(broom)

# 1. Fit the model
lbw_model <- lm(bwt ~ lwt, data = lbw_data)

# 2. Tidy the coefficients into an accessible table
model_stats <- tidy(lbw_model)

knitr::kable(
  model_stats,
  col.names = c("Term", "Estimate", "Std. Error", "t-statistic", "p-value"),
  digits = 3
)
```

---

### How to interpret the summary:

* **Intercept ($\beta_0$):** The predicted value of $y$ when $x$ is zero.
* **Slope ($\beta_1$):** For every 1 unit increase in $x$, how much $y$ is expected to change.
* **R-squared ($R^2$):** The percentage of variation in $y$ explained by your model. (e.g., $0.75$ means your model explains 75% of the data).

## Part 4: Making Predictions
Once you have a model, you can plug in a value for $x$ to predict $y$. If our model is $Mass = -100 + 1.2(Height)$, we can predict the mass of a character who is 200cm tall.
## Model Prediction: 150lb Mother

Using our regression model, we can predict the specific birth weight for a baby based on the mother's weight.

> **Accessible Logic:** We are plugging 150 into our regression equation ($y = mx + b$). The `predict()` function calculates this value for us automatically using the model we previously fitted.

```{r}
#| label: tbl-prediction
#| tbl-cap: "Predicted Birth Weight for a mother weighing 150 lbs."

# 1. Create a data frame for the input (required by the predict function)
new_mom <- data.frame(lwt = 150)

# 2. Run the prediction
prediction_val <- predict(lbw_model, newdata = new_mom)

# 3. Present the result in a clear, single-row table
prediction_table <- data.frame(
  input_lwt = 150,
  predicted_bwt = prediction_val
)

knitr::kable(
  prediction_table,
  col.names = c("Mother's Weight (lbs)", "Predicted Birth Weight (g)"),
  digits = 2
)
```

---

<div class="dcc-important">
**Lab Task 17:**

1. Pick two numeric variables from your dataset that you think are related.
2. Create a **Scatter Plot** and add a linear regression line.
3. Use the `cor()` function to find the correlation coefficient.
4. Fit a linear model using `lm()` and look at the `summary()`.
5. **The Report:**
   * What is the slope of your model? 
   * What is the $R^2$ value? 
   * Use your model to make one prediction for a value not in your dataset.
</div>

---


---

::: {.callout-tip}
### Done with the Lab?
If you have finished all the tasks above, you can verify your work against the official solutions.

<center>
<a href="../solutions.html" class="btn btn-outline-success" role="button">ðŸ”“ Access Lab Solutions</a>
</center>
:::

