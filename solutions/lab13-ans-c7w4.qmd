---
title: "Solution - Lab 13: Statistical inference for two proportions"
subtitle: "MAT 186: Introduction to Data Science"
format:
  html:
    toc: true
    toc-location: right
---

<script>
  var password = "MAT186LABSOER";
  var res = prompt("DCC Instructor Key Required:");
  if (res != password) {
    alert("Incorrect password. Access denied.");
    window.location.href = "../index.html";
  }
</script>

## Statistical inference for two proportions - Official Solutions
In this lab, we compare the proportion of "Successes" (which we will define as Hispanic/Latino student enrollment) between two distinct groups (Community Colleges and Doctoral Institutions).
::: {.callout-note}
### Instructor Note
Add your specific DCC lab answers below this box.
:::
## Lab 13 Official Solutions: Two-Sample Proportion Inference

In this lab, we test whether the proportion of Hispanic/Latino students differs significantly between Community Colleges and Doctoral Institutions.

### Task 1: Preparing the Binary Outcome
Our dataset provides counts. To create a "Success/Failure" comparison, we define "Success" as being a Hispanic/Latino student and "Failure" as being any other student within that sector.

```{r}
#| message: false
#| warning: false
library(tidyverse)

# Load and clean the data
ny_data <- read_csv("../data/race_ny.csv")

# 1. Clean numeric columns and filter for two groups
comparison_data <- ny_data |>
  mutate(
    total = as.numeric(gsub(",", "", `Total Enrollment`)),
    hispanic = as.numeric(gsub(",", "", `Hispanic/Latino`)),
    other = total - hispanic
  ) |>
  filter(`Institution Sector` %in% c("Community Colleges", "Doctoral Degree Granting Institutions")) |>
  group_by(`Institution Sector`) |>
  summarise(
    total_hispanic = sum(hispanic, na.rm = TRUE),
    total_other = sum(other, na.rm = TRUE),
    total_n = sum(total, na.rm = TRUE)
  )
```


### Task 2: Visualizing with a Stacked Bar Chart
We use position = "fill" to create a chart that compares the relative proportions (the percentage) rather than the raw counts.

```{r}
#| label: fig-stacked-bar
#| fig-cap: "Stacked bar chart showing the proportion of Hispanic/Latino students versus other students by sector."
#| fig-alt: "A stacked bar chart comparing two sectors. The Y-axis represents the percentage (0 to 100%). Each bar is split into 'Hispanic' and 'Other'. The Community College bar shows a visually larger segment for Hispanic students compared to the Doctoral Institutions bar."

# Reshape data for plotting
plot_data <- comparison_data |>
  pivot_longer(cols = c(total_hispanic, total_other), 
               names_to = "Outcome", 
               values_to = "Count")

ggplot(plot_data, aes(x = `Institution Sector`, y = Count, fill = Outcome)) +
  geom_bar(stat = "identity", position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  scale_fill_manual(values = c("darkorange", "grey80"), 
                    labels = c("Hispanic/Latino", "Other")) +
  labs(title = "Proportion of Hispanic/Latino Enrollment",
       x = "Institution Sector",
       y = "Percentage of Total Enrollment") +
  theme_minimal()
```

### Task 3: State Your HypothesesWe are testing if the proportion of Hispanic/Latino students is the same in both sectors.

* **Null Hypothesis ($H_0$):** The proportion of Hispanic students is the same in both sectors ($p_1 = p_2$).

* **Alternative Hypothesis ($H_a$):** The proportion of Hispanic students is different between the two sectors ($p_1 \neq p_2$).

### Task 4: Running the Proportion Test
We use prop.test() by providing the vector of successes and the vector of total sample sizes.

```{r}
#| label: prop-test-two-sample
# Run the test
# successes = c(Group1_Success, Group2_Success)
# totals = c(Group1_Total, Group2_Total)
p_test <- prop.test(x = comparison_data$total_hispanic, 
                    n = comparison_data$total_n)

# Display results
p_test
```

### Task 5: Conclusion
Based on the statistical analysis:

**Formal Conclusion:** Since the p-value was r format.pval(p_test$p.value, digits = 4), which is less than the alpha level of 0.05, we reject the null hypothesis and conclude there is a significant difference in the proportions of Hispanic/Latino students between Community Colleges and Doctoral Institutions.

<br><br>

***

::: {.content-block}
<center>
<a href="../solutions.html" class="btn btn-primary btn-lg" role="button">üè† Back to Solutions Hub</a>
</center>
:::

